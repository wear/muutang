<% content_for :header do -%> 
	<%= include_tiny_mce_if_needed %>
	<%= javascript_include_tag 'syntaxhihglighter/shCore.js','syntaxhihglighter/shBrushRuby.js' %>  
	<%= stylesheet_link_tag 'syntaxhihglighter/shCore.css','syntaxhihglighter/shThemeDefault.css' %>
	<script type="text/javascript">
		SyntaxHighlighter.config.clipboardSwf = '/javascripts/syntaxhihglighter/clipboard.swf';
		SyntaxHighlighter.all();
	</script> 
	<style type="text/css" media="screen">
		.content-width img{MAX-WIDTH: 100%!important;HEIGHT: auto!important;width:expression(this.width > 600 ? "600px" : this.width)!important;}
	</style>                   
<% end %> 

<% content_for :bread do -%> 
	<div id="bread" class='ui-corner-all'>
		<%=link_to '首页',root_path %> >> <%=h @post.title %>
	</div>
<% end %>
<table width="700" style='table-layout:fixed'>
	<tr><td valign="top" width='80px' style='text-align:center'><%=image_tag @post.user.avatar.url(:medium) %><br /><b><%=h @post.user.login%></b></td>
	<td><span class='title'><%=h @post.title %></span> 
		<p>
		<% if @post.user == current_user && @post.editable? %>
			<%=pretty_button '编辑',edit_post_path(@post) %>
		<% end %>  
		<% restrict_to "(editor | superuser)" do %>
	    	<%=mark_top_button(@post)%>
			<%=pretty_button '删除',admin_post_path(@post),:method => :delete,:confirm => "你确定嘛?" %>
		<% end %>
		</p>
		<div class='content-width'><%= @post.body %></div><span style='color:#999999'><%= time_ago_in_words_or_date(@post.created_at) %> </span> <br />
		</td>
		</tr>
</table>   

<% unless @comments.blank? %>                   
<h3>所有评论</h3>        
<%= will_paginate @comments,:previous_label => '< 前页',:next_label => '后页 >'  %>  
<table class='comment'>       
   <%= render @comments %>
</table>   
<%= will_paginate @comments,:previous_label => '< 前页',:next_label => '后页 >' %>   
<% end %>
                
<% if @post.can_comment -%>
<% if logged_in? -%>
	<h3>发表评论</h3>  
	<% form_for(:comment,@comment,:url=> post_comments_path(@post),:html => {:id => 'form'}) do |f| -%>
  		<%= f.error_messages %>
  		<%= f.text_field :title,:value => "回复:#{h(@post.title)}",:label => '标题',:class => 'comment_title' %>	
  		<%= f.text_area :comment,:label => '内容',:class => "mceEditor" %>
  		<%= f.submit '提交' %>
	<% end -%> 
<% else -%>  
	<h3>评论前请先登录</h3>
	<% form_tag session_path,:id => 'form' do -%>
	<p><%= label_tag '用户名' %><br />
	<%= text_field_tag 'login', @login %></p>

	<p><%= label_tag '密码' %><br/>
	<%= password_field_tag 'password', nil %></p>

	<p><%= submit_tag '提交' %></p>
	<% end -%>
<% end -%>
<% end -%>